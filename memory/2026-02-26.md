# 2026-02-26 — Design learnings (RLS Jerusalem #336)

## Context
Public site for **R.·. L.·. S.·. Jerusalem #336** (Next.js + Tailwind + custom CSS variables). We iterated heavily to get desktop + mobile navigation, layout and styling right.

## Key learnings (so next time we one-shot)

### 1) Don’t mix **fixed sidebar** with a **2-column grid reservation**
- If the sidebar is `position: fixed`, you generally **should not** also reserve a grid column (`grid-template-columns: 200px 1fr`).
- Otherwise you risk a **double offset** (grid column + `margin-left`), and content can look “missing” (actually pushed out of view) on desktop.

**Rule of thumb:**
- Fixed sidebar ⇒ layout container should be `display: block` and content area uses `margin-left: sidebarWidth` (desktop only).

### 2) Tailwind color opacity syntax can break with CSS variable colors
- Classes like `text-foreground/90`, `bg-accent/5`, `border-accent/20` can behave unexpectedly depending on Tailwind config + CSS variables.
- It can result in **nearly invisible text** (appears as “black screen”).

**Safer patterns:**
- Use `text-foreground` + `opacity-90` (separate concerns)
- Or explicit `rgba(...)` / `color-mix(...)` for backgrounds/borders.

### 3) Stacking context > z-index (mobile menus)
- When a hamburger button is inside containers with `overflow: hidden`, transforms, or positioned ancestors, `position: fixed` can still feel “behind” the app.
- Raising z-index isn’t enough if global CSS later overrides it.

**Robust solution:**
- Render hamburger + overlay + sidebar via **React Portal to `document.body`**.
- If global CSS is overriding Tailwind z-classes, prefer **inline `style={{ zIndex: ... }}`** for critical layering.

### 4) Overlay blur frequently blocks clicks
- Even with “correct” z-index, overlays can still intercept touch events due to stacking contexts.

**Solution:**
- Ensure overlay is **below** sidebar.
- When in doubt: portal everything to body and set explicit zIndex ordering.

### 5) Texture layers can kill UI affordances
- A `::before` texture overlay can mute active highlights.

**Solution:**
- Put texture at `z-index: 0` and nav at `z-index: 1`.
- Use `isolation: isolate` to keep blending contained.

### 6) Keep Home minimal + separate content canvas
- Home should only show the carousel (clean, intentional).
- Other tabs should render in a consistent right-panel “canvas” (padding, width constraints, typography).

### 7) Process improvements (efficiency)
- Before long iteration loops, validate:
  1) Desktop layout math (sidebar width + margins)
  2) Mobile stacking/overflow behavior
  3) Tailwind opacity + CSS variable compatibility
- Avoid big refactors mid-flight unless you keep old content intact or migrate carefully.

## Final fixes that mattered most
- Removed grid column reservation (desktop content re-appeared).
- Avoided `/opacity` Tailwind shorthand with CSS vars.
- Portaled hamburger/overlay/sidebar to body and forced zIndex inline.

## What actually caused the long iteration loop (root causes)
1. **Layout model conflict (desktop):**
   - We mixed: `fixed` sidebar + reserved grid column + `margin-left`.
   - Symptoms: content "missing" (actually off-canvas), weird gaps, header/footer overlap.
2. **Color/opacity mismatches:**
   - Tailwind `color/opacity` shorthand didn’t play nicely with our CSS-variable theme.
   - Symptoms: “black screen”, text exists but is effectively invisible.
3. **Mobile layering wasn’t a z-index problem:**
   - Stacking contexts (`overflow: hidden`, transforms, fixed inside positioned ancestors) made `fixed` feel non-fixed.
   - Symptoms: hamburger only visible after scrolling; blur overlay intercepting taps.
4. **Global CSS overriding Tailwind utility classes:**
   - `.sidebar { z-index: 10 }` in `globals.css` could override Tailwind `z-[...]` depending on injection order.
   - Symptoms: we thought z-index changed, but actual computed style didn’t.

## The “One-shot UI” playbook (next time)
### A) Decide the layout model up front (pick ONE)
- **Option 1:** Sidebar is `fixed` ⇒ layout container is `block`; content uses `margin-left` on desktop.
- **Option 2:** Sidebar participates in layout (not fixed) ⇒ use grid/flex columns; no `margin-left` hacks.

### B) Before styling, run a 10-minute layout audit
- Desktop: confirm content is visible at 1366/1440/1920 widths.
- Confirm only one scroll container (either body or right panel).
- Confirm header height & sidebar top offset are consistent.

### C) Navigation strategy
- Mobile: implement hamburger early.
- If any `overflow: hidden`/transforms exist: **immediately plan for a Portal**.

### D) Theming rules
- If using CSS vars + Tailwind, avoid `text-*/NN` shorthands.
- Prefer:
  - `text-foreground` + `opacity-*`
  - `rgba(...)` for subtle panels and borders

### E) Layering rules
- For mobile menu, hard-code a layering scheme:
  - button: 10001
  - menu: 10000
  - overlay: 9999
- If utilities get overridden: use **inline `style={{ zIndex }}`** for critical layers.

## Checklist (copy/paste for new projects)
- [ ] Choose layout model (fixed sidebar vs in-flow sidebar) and stick to it.
- [ ] No double offsets (grid column + margin-left).
- [ ] Decide scroll container (body OR panel) and enforce.
- [ ] Add hamburger early; if weird → portal it.
- [ ] Overlay below menu; taps must reach menu.
- [ ] Texture overlays: `::before` z0, content z1, `isolation: isolate`.
- [ ] Avoid Tailwind `/opacity` shorthand with CSS vars.
- [ ] Validate computed styles (z-index, color) in devtools before iterating.

